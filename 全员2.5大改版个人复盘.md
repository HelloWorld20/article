---
title: 全员2.5大改版个人复盘
date: 2021-08-12 16:10
tags: 
    - [总结]
---

# 前言

开发始于7月14，于8月12上线

# 正文

## 功绩

### 1. 大胆的使用上css变量。统一主题色

需求是把整个应用的主题色从橙色换成蓝色。不仅是一个颜色，而是一套颜色。当时脑子里第一个想到的就是css变量。所以当即尝试了一下。发现确实有效。安卓、ios、pc端以及企业微信端，都能使用。

后来收集信息了解到，caniuse上，css变量从chrome49开始支持，即使最老旧的pc版浏览器也是chrome 53内核。所以目前兼容性应该是没问题了的。

接下来考虑如何实施。

主要是根据UI顶的色调来命名：--primary-color、--primary-bg-color、--text-color-1、--text-color-2等。

定义好所有变量后，全局搜索，所有就色值，替换。

实际上遇到，部分地方用的rgba写法，而css变量写的十六进制颜色。后来了解到css变量不用一定要写一个`有意义`的值，更多的是一个`字符串`。所以可以如下解决:

```css
// 定义
--primary-rgb-color: 65, 107, 246;
// 使用
background: rgba(var(--primary-rgb-color), 0.04);

```

#### 作用域

css变量有作用域的概念。所以想要在整个应用使用css变量，则应该在跟元素上定义。小程序固定的根元素是`page`，所以在项目入口处定义即可

```css
page {
	--primary-rgb-color: 65, 107, 246;
	//...
}
```

在小程序里有个问题：js无法读取到dom元素。这样的话，定义的css变量则没有办法修改。如果以后要动态改变主色调，则这套方案直接失效。但是短期内不会有这样的需求，目前就按最佳的方式实现即可。

如果是web项目，则不存在此问题。web项目可以把css变量定义在不同的class中，然后js动态的修改跟元素的类名即可。 `主题色切换`的最佳实践其实就是这么实现的。

#### css变量使用方法

最佳入门还是阮一峰的[CSS 变量教程](http://www.ruanyifeng.com/blog/2017/05/css-variables.html)。

此处摘要一些主要的内容来讲

##### 变量声明

css变量声明必须是`--`开头，值可以随意设置。值应该是一段有`意义的值`。如，`#aaa`、`1,1,1`，不能是#aa。

```css
--color: #aaa

background: var(--color);
```
使用时用var()函数来读取，如上例子


##### 作用域

```html

<style>

.a { --test: red;}
.b {color: var(--test)}

</style>
<div class="a">
	<div class="b">something</div>
</div>

<div class="b">
	<div class="a">something</div>
</div>


```
类名b应该在a之内才能生效。反之不生效。

### 2. 重构登陆接口，大幅提升页面访问速度

原来的访问

#### 体验版二维码需指定访问路径，需兼容

## 一个hooks的绝佳使用场景

## webpack loader的exclude、include

## css animation

## 彩色icon

## 目前比较完美的小程序标题栏适配方案

## 多态模式的一个使用场景

